"use strict";(self.webpackChunkfrontend_contrader=self.webpackChunkfrontend_contrader||[]).push([[960],{3960:(G,g,o)=>{o.r(g),o.d(g,{default:()=>F});var m=o(2296),f=o(5195),t=o(6223),U=o(5986),y=o(6385),d=o(9157),h=o(617),v=o(2032),I=o(3680),Z=o(8525),T=o(1545),E=o(7914),u=o(8034),C=o(5940),D=o(6814),O=o(3149),l=o(3302),P=o(1081),e=o(5879),b=o(1522),x=o(1896),q=o(7700),k=o(6975),A=o(6025);const L=["fileInput"];function R(s,p){1&s&&e._uU(0,"Accesso")}const w=function(s){return{visibility:s}};let F=(()=>{var s;class p{constructor(a,r,i,n,_,M,N){this.utentiService=a,this._formBuilder=r,this.router=i,this.dialog=n,this.profileUpdateService=_,this.loginService=M,this.signupService=N,this.errorsConstant=l.sm,this.log="",this.hide=!0,this.imageData="",this.firstFormGroup=this._formBuilder.group({email:["",[t.kI.required,t.kI.pattern(/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/),t.kI.minLength(3),t.kI.maxLength(128)]],password:["",[t.kI.required,t.kI.minLength(8),t.kI.maxLength(64)]],password2:["",[t.kI.required,t.kI.minLength(8),t.kI.maxLength(64)]],usertype:["user",t.kI.required]},{validator:E.R.MatchPassword}),this.secondFormGroup=this._formBuilder.group({firstname:["",[t.kI.required]],lastname:["",[t.kI.required]],birthday:["",[t.kI.required]],genre:["UOMO",[t.kI.required]],nation:["",[t.kI.required]],province:["",[t.kI.required]],city:["",[t.kI.required]],address:["",[t.kI.required]]}),this.ERRORS_CONSTANT=l.sm}openFileInput(){this.fileInput.nativeElement.click()}goToProfile(){this.router.navigate(["user/profile"])}onFileSelected(a){const r=a.target.files;if(r.length>0){const i=r[0];let n=new FileReader;n.readAsDataURL(i),n.onload=()=>{this.imageData=n.result},console.log("Nome del file:",i.name),console.log("Dimensione del file:",i.size),console.log("Tipo del file:",i.type),console.log()}}ngOnInit(){let a=localStorage.getItem("userSession");if(console.log("json modify: "+a),a){var r=JSON.parse(a);console.log(r.id),console.log("obj:"+r.userInfo.name)}this.utentiService.readUser(r.id).subscribe({next:i=>{console.log(i),this.user=i;var n=i.userInfoDTO;null!==i.image&&(this.imageData=i.image?.data),this.firstFormGroup=this._formBuilder.group({email:[this.user.username,[t.kI.required,t.kI.pattern(/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/),t.kI.minLength(3),t.kI.maxLength(128)]],password:[this.user.password,[t.kI.required,t.kI.minLength(8),t.kI.maxLength(64)]],password2:[this.user.password,[t.kI.required,t.kI.minLength(8),t.kI.maxLength(64)]],usertype:["user",t.kI.required]},{validator:E.R.MatchPassword}),this.secondFormGroup=this._formBuilder.group({firstname:[n.name,[t.kI.required]],lastname:[n.lastname,[t.kI.required]],birthday:[n.date,[t.kI.required]],genre:[n.genderType,[t.kI.required]],nation:[n.nation,[t.kI.required]],province:[n.province,[t.kI.required]],city:[n.city,[t.kI.required]],address:[n.address,[t.kI.required]]})}})}deleteProfile(){let a=-1;null!==this.user.id&&(a=this.user.id),this.dialog.open(P.g,{width:"660px",height:"300px",disableClose:!0,data:{title:l.sD.cancella_utente,body:l.sD.cancella_profilo,button:"ELIMINA"}}).afterClosed().subscribe(i=>{i&&this.utentiService.deleteUser(a).subscribe(n=>{this.dialog.open(O.t,{width:"660px",height:"300px",disableClose:!0,data:{title:l.cm.profile_delete_successful,body:l.cm.profile_delete_successful2}}).afterClosed().subscribe(()=>{this.router.navigate(["/login"])})})})}updateProfile(){var i={cart:this.user.cart,factoryDTO:this.user.factoryDTO,id:this.user.id,orders:this.user.orders,password:this.firstFormGroup.value.password,userInfoDTO:{address:this.secondFormGroup.value.address,city:this.secondFormGroup.value.city,date:this.secondFormGroup.value.birthday,genderType:this.secondFormGroup.value.genre,id:this.user.userInfoDTO.id,lastname:this.secondFormGroup.value.lastname,name:this.secondFormGroup.value.firstname,nation:this.secondFormGroup.value.nation,province:this.secondFormGroup.value.province},username:this.firstFormGroup.value.email,usertype:this.user.usertype,image:{id:this.user.id,data:this.imageData}};this.firstFormGroup.valid&&(this.log="",this.signupService.checkEmail(i.username,i.id).subscribe({next:n=>{n&&(this.log="Email gi\xe0 in uso"),""==this.log&&(this.loginService.setUtenteSession(i.username,i.userInfoDTO,i.usertype,i.id),this.utentiService.updateUser(i).subscribe({next:_=>{this.profileUpdateService.updateProfile(),this.dialog.open(O.t,{width:"660px",height:"300px",disableClose:!0,data:{title:l.cm.profile_update_successful,body:l.cm.profile_update_successful2}}).afterClosed().subscribe(()=>{this.goToProfile()})}}))}}))}}return(s=p).\u0275fac=function(a){return new(a||s)(e.Y36(b.p),e.Y36(t.qu),e.Y36(x.F0),e.Y36(q.uw),e.Y36(k.x),e.Y36(A.r6),e.Y36(A.Or))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-modify"]],viewQuery:function(a,r){if(1&a&&e.Gf(L,5),2&a){let i;e.iGM(i=e.CRH())&&(r.fileInput=i.first)}},standalone:!0,features:[e.jDz],decls:113,vars:23,consts:[[1,"detail-container"],[2,"width","75%","margin","0 auto"],[2,"padding-top","30px","padding-bottom","30px"],[1,"detail-card"],[1,"header-container"],[1,"image-edit",2,"position","relative","background-color","#47caff","width","64px","height","64px","border-radius","50%"],[2,"width","64px","height","64px","border-radius","32px","object-fit","cover","object-position","center",3,"ngStyle","src"],["type","file",2,"display","none",3,"change"],["fileInput",""],[2,"border-radius","50%","width","28px","height","28px","background-color","#a6039b","bottom","4px","right","-8px","position","absolute","display","flex","align-items","center","justify-content","center","cursor","pointer",3,"click"],[2,"color","white","font-size","15px","width","fit-content","height","fit-content"],["mat-raised-button","","color","primary",2,"background-color","#a6039b","color","white",3,"click"],[1,"anagrafica-container"],[1,"grey-text-title"],["autocomplete","off",3,"formGroup"],[1,"form-input-row"],["appearance","outline",2,"flex-grow","1","padding-right","10px"],["matInput","","placeholder","","formControlName","lastname","required","","maxlength","255"],["matInput","","placeholder","","formControlName","firstname","required","","maxlength","255"],["matInput","","formControlName","birthday","placeholder","Scegli data",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],["formControlName","genre",2,"display","none",3,"value"],["value","man"],["value","woman"],["mat-icon-button","","matSuffix",""],[2,"color","grey"],["matInput","","placeholder","","formControlName","nation","required","","maxlength","255"],["matInput","","placeholder","","formControlName","province","required","","maxlength","2"],["matInput","","placeholder","","formControlName","city","required","","maxlength","255"],["matInput","","placeholder","","formControlName","address","required","","maxlength","255"],[1,"accesso-container"],[1,"error"],["matStepLabel",""],[1,"form-input-row",2,"margin","0px !important"],["appearance","outline",2,"flex-grow","1","padding-right","5px"],["matInput","","placeholder","ex@example.com","formControlName","email","name","email","required","","maxlength","128"],["appearance","outline",2,"flex-grow","1","padding-left","5px"],["formControlName","usertype",3,"value"],["value","user"],["value","admin"],["name","password","matInput","","formControlName","password","required","","maxlength","64",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","password2","required","","maxlength","64",3,"type"],[1,"gestioneaccount-container"],[2,"color","lightgray"],["mat-stroked-button","","color","primary",2,"width","120px","border","1px solid #da0b00","color","#da0b00",3,"click"]],template:function(a,r){if(1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3,"Modifica Profilo"),e.qZA(),e.TgZ(4,"mat-card",3)(5,"div",4)(6,"div",5),e._UZ(7,"img",6),e.TgZ(8,"input",7,8),e.NdJ("change",function(n){return r.onFileSelected(n)}),e.qZA(),e.TgZ(10,"div",9),e.NdJ("click",function(){return r.openFileInput()}),e.TgZ(11,"mat-icon",10),e._uU(12,"edit"),e.qZA()()(),e.TgZ(13,"button",11),e.NdJ("click",function(){return r.updateProfile()}),e._uU(14,"SALVA"),e.qZA()(),e.TgZ(15,"div",12)(16,"p",13),e._uU(17,"Dati Anagrafici"),e.qZA(),e.TgZ(18,"form",14)(19,"div",15)(20,"mat-form-field",16)(21,"mat-label"),e._uU(22,"Cognome"),e.qZA(),e._UZ(23,"input",17),e.qZA(),e.TgZ(24,"mat-form-field",16)(25,"mat-label"),e._uU(26,"Nome"),e.qZA(),e._UZ(27,"input",18),e.qZA()(),e.TgZ(28,"div",15)(29,"mat-form-field",16)(30,"mat-label"),e._uU(31,"Data"),e.qZA(),e._UZ(32,"input",19)(33,"mat-datepicker-toggle",20)(34,"mat-datepicker",null,21),e.qZA(),e.TgZ(36,"mat-form-field",16)(37,"mat-label"),e._uU(38,"Genere"),e.qZA(),e.TgZ(39,"mat-select",22)(40,"mat-option",23),e._uU(41,"Uomo"),e.qZA(),e.TgZ(42,"mat-option",24),e._uU(43,"Donna"),e.qZA()(),e.TgZ(44,"button",25)(45,"mat-icon",26),e._uU(46),e.qZA()()()(),e.TgZ(47,"div",15)(48,"mat-form-field",16)(49,"mat-label"),e._uU(50,"Nazione"),e.qZA(),e._UZ(51,"input",27),e.qZA(),e.TgZ(52,"mat-form-field",16)(53,"mat-label"),e._uU(54,"Provincia"),e.qZA(),e._UZ(55,"input",28),e.qZA(),e.TgZ(56,"mat-form-field",16)(57,"mat-label"),e._uU(58,"Citt\xe0"),e.qZA(),e._UZ(59,"input",29),e.qZA(),e.TgZ(60,"mat-form-field",16)(61,"mat-label"),e._uU(62,"Indirizzo"),e.qZA(),e._UZ(63,"input",30),e.qZA()()()(),e.TgZ(64,"div",31)(65,"p",32),e._uU(66),e.qZA(),e.TgZ(67,"p",13),e._uU(68,"Dati di accesso"),e.qZA(),e.TgZ(69,"form",14),e.YNc(70,R,1,0,"ng-template",33),e.TgZ(71,"div",34)(72,"mat-form-field",35)(73,"mat-label"),e._uU(74,"Email"),e.qZA(),e._UZ(75,"input",36),e.TgZ(76,"mat-error"),e._uU(77),e.qZA()(),e.TgZ(78,"mat-form-field",37)(79,"mat-label"),e._uU(80,"Tipologia Utente"),e.qZA(),e.TgZ(81,"mat-select",38)(82,"mat-option",39),e._uU(83,"User"),e.qZA(),e.TgZ(84,"mat-option",40),e._uU(85,"Admin"),e.qZA()()()(),e.TgZ(86,"div",15)(87,"mat-form-field",35)(88,"mat-label"),e._uU(89,"Enter your password"),e.qZA(),e._UZ(90,"input",41),e.TgZ(91,"button",42),e.NdJ("click",function(){return r.hide=!r.hide}),e.TgZ(92,"mat-icon"),e._uU(93),e.qZA()(),e.TgZ(94,"mat-error"),e._uU(95),e.qZA()(),e.TgZ(96,"mat-form-field",37)(97,"mat-label"),e._uU(98,"Enter your password again"),e.qZA(),e._UZ(99,"input",43),e.TgZ(100,"button",42),e.NdJ("click",function(){return r.hide=!r.hide}),e.TgZ(101,"mat-icon"),e._uU(102),e.qZA()(),e.TgZ(103,"mat-error"),e._uU(104),e.qZA()()()()(),e.TgZ(105,"div",44)(106,"p",13),e._uU(107,"Gestione Account"),e.qZA(),e.TgZ(108,"div",4)(109,"p",45),e._uU(110,"Puoi eliminare il tuo account e tutti i dati associati ad esso."),e.qZA(),e.TgZ(111,"button",46),e.NdJ("click",function(){return r.deleteProfile()}),e._uU(112,"ELIMINA"),e.qZA()()()()()()),2&a){const i=e.MAs(35);e.xp6(7),e.Q6J("ngStyle",e.VKq(21,w,""===r.imageData.trim()?"hidden":"visible"))("src",""!==r.imageData?r.imageData:"#",e.LSH),e.xp6(11),e.Q6J("formGroup",r.secondFormGroup),e.xp6(14),e.Q6J("matDatepicker",i),e.xp6(1),e.Q6J("for",i),e.xp6(6),e.Q6J("value","UOMO"),e.xp6(7),e.Oqu("arrow_drop_down"),e.xp6(20),e.Oqu(r.log),e.xp6(3),e.Q6J("formGroup",r.firstFormGroup),e.xp6(8),e.Oqu(r.firstFormGroup.controls.email.hasError("pattern")?r.errorsConstant.input.email_pattern:""===r.firstFormGroup.controls.email.value?r.errorsConstant.required:r.firstFormGroup.controls.email.hasError("minlength")?r.errorsConstant.input.min_length_3:r.errorsConstant.input.max_length_128),e.xp6(4),e.Q6J("value","user"),e.xp6(9),e.Q6J("type",r.hide?"password":"text"),e.xp6(1),e.uIk("aria-label","Hide password")("aria-pressed",r.hide),e.xp6(2),e.Oqu(r.hide?"visibility_off":"visibility"),e.xp6(2),e.Oqu(""===r.firstFormGroup.controls.password.value?"Campo obbligatorio":r.firstFormGroup.controls.password.hasError("minlength")?"Almeno 8 caratteri":""),e.xp6(4),e.Q6J("type",r.hide?"password":"text"),e.xp6(1),e.uIk("aria-label","Hide password")("aria-pressed",r.hide),e.xp6(2),e.Oqu(r.hide?"visibility_off":"visibility"),e.xp6(2),e.Oqu(r.firstFormGroup.controls.password2.hasError("passwordMismatch")?"Le password devono coincidere":"")}},dependencies:[m.ot,m.lW,m.RK,f.QW,f.a8,t.u5,t._Y,t.Fj,t.JJ,t.JL,t.Q7,t.nD,U.p9,y.t,d.lN,d.KE,d.hX,d.TO,d.R9,h.Ps,h.Hw,v.c,v.Nt,I.Ng,I.ey,Z.LD,Z.gD,T.T5,T.VY,t.UX,t.sg,t.u,u.FA,u.Mq,u.hl,u.nW,C.Cq,D.PC],styles:[".detail-container[_ngcontent-%COMP%]{background-color:#f3f3f3;width:100%;padding:20px 0 40px}.detail-card[_ngcontent-%COMP%]{width:100%;background-color:#fff;padding:20px}.header-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.grey-text-title[_ngcontent-%COMP%]{color:gray;font-weight:700;font-size:20px;padding:30px 0 10px}.form-input-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:100%;padding:2px;background-color:#fff;border-radius:8px}.form-input-row[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form-input-row[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.938rem;font-weight:700;color:#656d70;line-height:15px;text-decoration:none}.error[_ngcontent-%COMP%]{text-align:center;margin-top:8px;margin-bottom:2px;white-space:pre-line;font-size:1.5rem;font-weight:500;color:#d32f2f;line-height:19px}"]}),p})()}}]);